name: qctools

on: [push, pull_request]

jobs:

  build-macos-no-brew:

    strategy:
      matrix:
        compiler: ['gcc-7', 'gcc-8', 'gcc-9', 'clang-6', 'clang-9']
        include:
          - compiler: gcc-7
            packages: gcc@7
            env: { 'CC': 'gcc-7', 'CXX': 'g++-7' }
          - compiler: gcc-8
            packages: gcc@8
            env: { 'CC': 'gcc-8', 'CXX': 'g++-8' }
          - compiler: gcc-9
            packages: gcc@9
            env: { 'CC': 'gcc-9', 'CXX': 'g++-9' }
          - compiler: clang-6
            packages: llvm@6
            env: { 'CC': 'clang-6.0', 'CXX': 'clang++-6.0' }
          - compiler: clang-9
            packages: llvm@9
            env: { 'CC': 'clang-9', 'CXX': 'clang++-9' }

    runs-on: macos-latest

    env: ${{ matrix.env }}

    steps:
    - uses: actions/checkout@v2.0.0
      with:
        fetch: 1

    - name: Install dependencies
      run: |
        brew install ${{ matrix.packages }} qt5 nasm

    - name: Set Qt5 environment path
      run: |
        echo "::add-path::/usr/local/opt/qt5/bin"

    - name: Build qwt
      run: |
        git clone --depth 1 https://github.com/opencor/qwt ../qwt
        cd ../qwt
        qmake -r
        make -j4

    - name: Build FFmpeg
      run: |
        git clone --depth 1 https://github.com/FFmpeg/FFmpeg ../ffmpeg
        cd ../ffmpeg
        ./configure --enable-gpl \
                    --enable-static \
                    --disable-shared \
                    --disable-autodetect \
                    --disable-securetransport \
                    --disable-videotoolbox \
                    --disable-doc \
                    --disable-ffplay \
                    --disable-ffprobe \
                    --disable-debug
        make -j4

    - name: Build QCTools
      env:
        QCTOOLS_USE_BREW: false
      run: |
        cd Project/QtCreator
        qmake
        make -j4
